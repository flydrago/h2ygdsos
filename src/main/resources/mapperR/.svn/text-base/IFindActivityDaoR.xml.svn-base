<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.h2y.os.dao.read.IFindActivityDaoR">

	
	<select id="get" parameterType="long" resultType="hashmap">
		select fa.*,
		CONCAT('?bn=findActivityDown&amp;id=',CAST(fa.id AS CHAR)) as img 
		from tb_find_activity fa 
		where fa.id = #{id}
	</select>

	<select id="getListMap" parameterType="hashmap" resultType="hashmap">
		select 
			fa.*,
			dd.value as activity_level_name,
			d.value as activity_type_name,
			CONCAT('?bn=findActivityDown&amp;id=',CAST(fa.id AS CHAR)) as img
		from
		tb_find_activity fa
		JOIN(
			tb_sys_dict_detail dd
			JOIN tb_sys_dict_main dm ON dd.dict_main_id = dm.id
			AND dm.dict_code = 'activity_level'
		)ON fa.activity_level = dd.`code`
		JOIN(
			tb_sys_dict_detail d
			JOIN tb_sys_dict_main dt ON d.dict_main_id = dt.id
			AND dt.dict_code = 'activity_type'
		)ON fa.activity_type = d.`code`
		<trim prefix="WHERE" prefixOverrides="AND |OR ">
			fa.activity_status &lt;&gt; -1
			and (fa.unit_id = #{unitId} or fa.unit_id = 1)
			
		</trim>
		order by fa.create_date desc
		limit ${(page-1)*pagesize},${pagesize}
	</select>


	<select id="getListCount" parameterType="hashmap" resultType="long">
		select 
			count(fa.id)			
		from
		tb_find_activity fa
		JOIN(
			tb_sys_dict_detail dd
			JOIN tb_sys_dict_main dm ON dd.dict_main_id = dm.id
			AND dm.dict_code = 'activity_level'
		)ON fa.activity_level = dd.`code`
		JOIN(
			tb_sys_dict_detail d
			JOIN tb_sys_dict_main dt ON d.dict_main_id = dt.id
			AND dt.dict_code = 'activity_type'
		)ON fa.activity_type = d.`code`
		<trim prefix="WHERE" prefixOverrides="AND |OR ">
			fa.activity_status &lt;&gt; -1
			and (fa.unit_id = #{unitId} or fa.unit_id = 1)
			
		</trim>
		
	</select>

	<!-- 根据zoneCode获取公司信息 -->
	<select id="getUnitByZoneCode" parameterType="string" resultType="hashmap" >
		select * from tb_sys_units  where zone_code=#{zoneCode} and unit_type=0
	</select>
	
</mapper>